#!/bin/sh

if [ "x$1" != "x" ]; then
    port=$(echo $1 | perl -nle 'print $1 if /\:(\d+)$/')
    host=${1%:$port}
fi

# bug if no not use sh -c
# see: http://www.fan.gr.jp/~azure/diary/dia201002.html#n20100224
sh -c "rsync -avz -c \
    $([ "x$port" != x ] && echo "-e \"ssh -p $port\"") \
    --exclude=*.swp \
    --exclude=.git \
    --exclude=$(basename $0) \
    . $([ "x$host" != x ] && echo $host:)~/"
